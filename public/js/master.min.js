app={};(function(a,b){a(document).ready(function(){if(typeof b.organisation==="undefined"){b.organisation={}}function c(){this.$creator=a("#organisation-creator"),this.$organisation=a("#organisation"),this.$new=this.$creator.find("[name=organisation_name]");this.$locations=a("#location-selector");this.init()}c.prototype={init:function(){this.events()},events:function(){var d=this;this.$creator.on("click",".btn-primary",function(){d.create()});this.$organisation.on("change",function(){if(a(this).val()==="new"){d.$creator.modal("show",function(){d.$new.focus()})}else{if(a(this).val()===""){d.$location.hide();d.$location.val("")}else{b.locations.loader.load(a(this).val())}}});this.$creator.on("click",'[data-dismiss="modal"]',function(){d.$organisation.val("")});this.$creator.on("submit","form",function(e){d.$creator.find(".btn-primary").trigger("click");e.preventDefault()})},create:function(){var d=this;if(this.$new.val()!==""){this.persist(function(e){d.cleanErrors();e.status==="oke"?d.success(e):d.error(e)})}},persist:function(d){a.ajax({url:"/organisations",type:"POST",data:{name:this.$new.val()},dataType:"json",success:function(e){d(e)}})},success:function(d){this.$creator.find(".alert").addClass("hide");this.add(d.organisation);this.$new.val("");this.$creator.modal("hide");b.locations.loader.load(d.organisation.id)},error:function(d){var f=d.errors.name;for(var e in f){this.$creator.find(".alert").append(a("<span>",{text:f[e]})).removeClass("hide")}},add:function(d){this.$organisation.find("option:last-child").before(a("<option>",{value:d.id,html:d.name,selected:true}))},cleanErrors:function(){this.$creator.find(".alert").html("")}};a(document).ready(function(){b.organisation.creator=new c()})})})(window.jQuery,window.app);(function(a,b){a(document).ready(function(){if(typeof b.locations==="undefined"){b.locations={}}function c(){this.$modal=a("#locations-creator");this.$location=a("#location");this.$organisation=a("#organisation");this.init()}c.prototype={init:function(){this.events()},events:function(){var e=this;e.$location.on("change",function(){if(a(this).val()==="new"){e.cleanErrors();e.$modal.modal("show")}});e.$modal.on("click",".btn-primary",function(){e.create()})},create:function(){var e=this;if(e.validateInput()){e.persist(function(f){e.cleanErrors();f.status==="oke"?e.success(f):e.error(f)})}},persist:function(f){var e=this;a.ajax({url:"/organisations/"+e.$organisation.val()+"/locations",type:"POST",data:{name:this.$modal.find("[name=name]").val(),street:this.$modal.find("[name=street]").val(),postal:this.$modal.find("[name=postal]").val(),city:this.$modal.find("[name=city]").val()},success:function(g){f(g)}})},success:function(e){this.$modal.find(".alert").addClass("hide");this.add(e.location);this.emptyFields();this.$modal.modal("hide")},error:function(e){var j=e.errors;for(var h in j){for(var f in j[h]){var i=this.$modal.find(".alert[data-target="+h+"]");var g=i.html();i.html(g+j[h][f]);i.removeClass("hide")}}},emptyFields:function(){this.$modal.find("[name=street]").val("");this.$modal.find("[name=postal]").val("");this.$modal.find("[name=city]").val("");this.$modal.find("[name=name]").val("")},add:function(e){this.$location.find("option:last-child").before(a("<option>",{value:e.id,html:e.name,selected:true}))},cleanErrors:function(){this.$modal.find(".alert").html("").addClass("hide")},validateInput:function(){return true;return this.$modal.find("[name=street]").val()!==""&&this.$modal.find("[name=postal]").val()!==""&&this.$modal.find("[name=city]").val()!==""&&this.$modal.find("[name=name]").val()!==""}};function d(){this.$organisation=a("#organisation");this.$location=a("#location");this.events()}d.prototype={events:function(){},load:function(e){var f=this;a.ajax({url:"/organisations/"+e+"/locations/",dataType:"json",success:function(g){f.fill(g)}})},fill:function(e){var f=this.$location.find("option"),h=f.size(),j=f.filter(":last-child");f.each(function(k,l){if(k!==0&&k!==h-1){l.remove()}});for(var g in e){j.before(a("<option>",{value:e[g].id,html:e[g].name}))}this.$location.parents(".holder").removeClass("hide")}};b.locations.creator=new c();b.locations.loader=new d()})})(window.jQuery,window.app);